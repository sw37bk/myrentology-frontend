# AI Система для автоматизации переписки и бронирований

## Обзор системы

Создана комплексная AI система для автоматизации переписки с клиентами и создания бронирований на основе OpenAI GPT.

## Основные компоненты

### 1. База данных

**Таблицы:**
- `booking_templates` - Шаблоны условий бронирования
- `resource_booking_conditions` - Индивидуальные условия для каждого ресурса
- `ai_assistant_settings` - Настройки AI ассистента
- `ai_chat_logs` - Логи переписки с AI
- `auto_bookings` - Автоматически созданные бронирования

### 2. API Endpoints

**AI Assistant API (`/api/ai-assistant.php`):**
- `GET ?action=settings` - Получение настроек AI
- `POST ?action=settings` - Сохранение настроек AI
- `POST ?action=generate` - Генерация ответа AI
- `POST ?action=create_booking` - Создание автобронирования

**Booking Conditions API (`/api/booking-conditions.php`):**
- `GET ?user_id=X` - Получение шаблонов условий
- `GET ?user_id=X&resource_id=Y` - Получение условий ресурса
- `POST` - Создание шаблона условий
- `PUT` - Обновление условий ресурса

**AI Webhook (`/api/ai-webhook.php`):**
- Автоматическая обработка входящих сообщений
- Генерация ответов на основе условий ресурса
- Логирование переписки

### 3. Frontend Компоненты

**Настройки AI:**
- `AIAssistantSettings` - Настройка OpenAI API, модели, промптов
- `BookingConditionsSettings` - Управление условиями бронирования

**Интеграция в чаты:**
- `AIAssistantIntegration` - Панель AI в окне чата
- Обновленный `ChatWindow` с AI панелью

**Управление бронированиями:**
- `AutoBookings` - Просмотр и управление автобронированиями

## Функциональность

### 1. Настройка условий бронирования

**Шаблоны условий:**
- Создание общих шаблонов (залог, сроки, штрафы)
- Применение к нескольким ресурсам
- Группировка похожих условий

**Индивидуальные условия:**
- Привязка к конкретному ресурсу
- Описание для AI ассистента
- Особые требования и ограничения

### 2. AI Ассистент

**Настройки:**
- OpenAI API ключ
- Выбор модели (GPT-3.5, GPT-4)
- Системный промпт
- Стиль ответов
- Автоматическое создание бронирований

**Генерация ответов:**
- Учет условий бронирования ресурса
- Контекст переписки
- Персонализированные ответы

### 3. Автоматические бронирования

**Создание:**
- AI анализирует переписку
- Извлекает данные клиента и даты
- Создает предварительное бронирование
- Требует подтверждения оператора

**Управление:**
- Просмотр всех автобронирований
- Подтверждение/отклонение
- Интеграция с календарем

## Использование

### 1. Настройка AI

1. Перейти в **Настройки → AI Ассистент**
2. Указать OpenAI API ключ
3. Выбрать модель и стиль ответов
4. Настроить системный промпт
5. Включить автобронирования (опционально)

### 2. Настройка условий

1. Перейти в **Настройки → Условия бронирования**
2. Создать шаблоны общих условий
3. Для каждого ресурса:
   - Выбрать шаблон или создать индивидуальные условия
   - Добавить описание для AI
   - Указать особенности ресурса

### 3. Работа с чатами

1. В окне чата появляется AI панель
2. Быстрые действия для генерации ответов
3. AI учитывает условия конкретного ресурса
4. Возможность создания бронирования из чата

### 4. Автоматическая обработка

1. Настроить webhook в Авито на `/api/ai-webhook.php`
2. AI автоматически отвечает на входящие сообщения
3. Создает предварительные бронирования
4. Логирует всю переписку

## Преимущества

1. **Персонализация** - AI знает условия каждого ресурса
2. **Автоматизация** - Снижение нагрузки на операторов
3. **Консистентность** - Единообразные ответы клиентам
4. **Масштабируемость** - Обработка множества чатов одновременно
5. **Аналитика** - Логирование всех взаимодействий

## Безопасность

- API ключи хранятся в зашифрованном виде
- Логирование всех AI операций
- Контроль доступа по пользователям
- Возможность отключения автоответов

## Развитие

Планируемые улучшения:
- Интеграция с календарем для проверки доступности
- Анализ тональности сообщений
- Автоматическое определение намерений клиента
- Интеграция с CRM для истории клиентов
- Мультиязычная поддержка