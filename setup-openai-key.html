<!DOCTYPE html>
<html>
<head>
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenAI –∫–ª—é—á–∞</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="password"], input[type="text"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        .success { color: green; padding: 10px; background: #f0f8f0; border-radius: 4px; }
        .error { color: red; padding: 10px; background: #f8f0f0; border-radius: 4px; }
        .status { margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenAI API –∫–ª—é—á–∞</h1>
    <p>–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∏—Å—Ç–µ–º—ã</p>
    
    <div class="form-group">
        <label for="apiKey">OpenAI API Key:</label>
        <input type="password" id="apiKey" placeholder="sk-...">
    </div>
    
    <div class="form-group">
        <label for="proxy">OpenAI Proxy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
        <input type="text" id="proxy" placeholder="user:pass@ip:port" value="user236247:8tv39p@194.87.40.173:7213">
    </div>
    
    <div class="form-group">
        <label for="model">OpenAI –ú–æ–¥–µ–ª—å:</label>
        <select id="model">
            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (–±—ã—Å—Ç—Ä–∞—è, –¥–µ—à–µ–≤–∞—è)</option>
            <option value="gpt-4">GPT-4 (—É–º–Ω–∞—è, –¥–æ—Ä–æ–≥–∞—è)</option>
            <option value="gpt-4-turbo">GPT-4 Turbo (–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è)</option>
        </select>
    </div>
    
    <button onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <button onclick="checkStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
    
    <div id="result"></div>
    
    <script>
        async function saveSettings() {
            const apiKey = document.getElementById('apiKey').value;
            const proxy = document.getElementById('proxy').value;
            const model = document.getElementById('model').value;
            const result = document.getElementById('result');
            
            try {
                const response = await fetch('/api/admin-ai-settings.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: 1,
                        openai_api_key: apiKey,
                        openai_proxy: proxy,
                        openai_model: model
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = '<div class="success">‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</div>';
                    document.getElementById('apiKey').value = '';
                } else {
                    result.innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</div>';
                }
            } catch (error) {
                result.innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message + '</div>';
            }
        }
        
        async function checkStatus() {
            const result = document.getElementById('result');
            
            try {
                const response = await fetch('/api/admin-ai-settings.php?user_id=1');
                const data = await response.json();
                
                result.innerHTML = '<div class="status">' +
                    '<strong>–°—Ç–∞—Ç—É—Å OpenAI:</strong> ' + 
                    (data.has_key ? '‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω (' + data.key_preview + ')' : '‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω') +
                    '<br><strong>–ü—Ä–æ–∫—Å–∏:</strong> ' +
                    (data.has_proxy ? '‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω (' + data.proxy_preview + ')' : '‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω') +
                    '<br><strong>–ú–æ–¥–µ–ª—å:</strong> ' + data.model +
                    '</div>';
                    
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å
                document.getElementById('model').value = data.model;
            } catch (error) {
                result.innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message + '</div>';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkStatus();
    </script>
</body>
</html>